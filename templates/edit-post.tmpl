{{define "title"}}{{.Title}}{{end}}

{{define "body"}}
<h1>{{.Title}}</h1>

{{if .Post.Slug}}
<p><a target="_blank" href="{{.Paths.Preview}}{{.Post.Slug}}/">Preview post</a></p>
{{end}}

<form action="{{.ActionPath}}" method="post">
  <label for="title">
    <span class="label-text">Title:</span><br />
    <input value="{{.Post.Title}}" type="text" name="title" id="title" required />
  </label>
  <label for="slug">
    <span class="label-text">Slug:</span><br />
    <span class="hint">
        valid characters: a-z, A-Z, 0-9, hyphen, underscore, period, tilde
    </span><br />
    <input value="{{.Post.Slug}}" type="text" name="slug" id="slug" required
        pattern="^[\w\-\.\~]+$" />
  </label>

  <details open>
    <summary>
      <b>Attachments ({{len .Attachments}})</b>
      <a style="float:right;" href="{{.Paths.AttachmentsOfPost .Post.Id}}">Manage</a>
    </summary>
    <ul>
      {{if not .Attachments}}
      <p style="color: darkgray;">No attachments yet. Click "Manage" to add some!</p>
      {{end}}
      {{range .Attachments}}
      <li><a target="_blank" href="{{$.Paths.AttachmentPreview $.Post.Slug .Name}}">{{.Name}}</a> {{.Size}}</li>
      {{end}}
    </ul>
  </details>

  <label for="content">
    <span class="label-text">Content:</span><br />
    <span class="hint">
    we use <a tabindex="-1" href="https://djot.net/">djot</a> syntax which is a more
    well-defined Markdown variant - here's a
    <a tabindex="-1" href="https://github.com/jgm/djot/blob/main/doc/cheatsheet.md">cheatsheet</a>
    </span><br />
    <textarea id="content" name="content" cols="30" rows="20" required>{{.Post.Content}}</textarea>
  </label>

  <div>
    <label title="{{.DraftHint}}" for="is-draft">
      <input type="checkbox" {{if .Post.IsDraft}}checked{{end}}
        id="is-draft" name="is-draft" value="is-draft">
      Draft
    </label>
  </div>

  {{.CsrfTag}}

  <div>
    <input type="submit" value="{{.SubmitText}}" />
    {{if .Msg}}
    <span id="msg">
        {{.Msg}}
        â€” <a target="_blank" href="{{.Paths.Preview}}{{.Post.Slug}}/">preview here</a>
    </span>
    {{end}}

    {{if .ErrMsg}}<span id="err-msg">Error: {{.ErrMsg}}</span>{{end}}
  </div>
</form>

<style>
details > summary {
    background-color: #eaeaea;
    padding: 0.5rem;
    cursor: pointer;
    user-select: none;
}
details {
    background-color: #f7f7f7;
    border: 1px solid #ccc;
}
details ul {
    list-style: none;
    padding: 0 1rem;
}
</style>
{{end}}
